<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PDF Link Tool</title>
    <style>
        body { font-family: sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
        input { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 10px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #0061fe; color: white; border: none; border-radius: 4px; }
        button:hover { background: #004bb5; }
        .box { background: #f0f0f0; padding: 15px; border: 1px solid #ccc; margin-top: 20px; word-break: break-all; font-family: monospace; }
        label { font-weight: bold; display: block; margin-top: 20px; }
    </style>
</head>
<body>

    <h1>LibGuide PDF Generator</h1>
    <p>Paste your Dropbox link below:</p>

    <input type="text" id="dropboxLink" placeholder="https://www.dropbox.com/..." autofocus>
    <button onclick="generateLink()">Generate Code</button>

    <div id="results" style="display:none;">
        <label>Master Link (Test this first):</label>
        <div class="box" id="finalLink"></div>

        <label>LibGuide Embed Code (Copy this):</label>
        <div class="box" id="embedCode"></div>
    </div>

    <script>
        function generateLink() {
            const input = document.getElementById('dropboxLink').value.trim();
            
            // --- YOUR SETTINGS ---
            const viewerUrl = "https://crawby.github.io/pdf-reader/web/viewer.html";
            const workerUrl = "https://dropbox-guard.ccrawford.workers.dev/";
            // ---------------------

            if (!input) { alert("Paste a link first!"); return; }

            let base64Link;
            try { 
                base64Link = btoa(input); 
            } catch (e) { 
                alert("Error: Could not encode link."); return; 
            }

            // 1. Create the URL
            const finalUrl = `${viewerUrl}?file=${workerUrl}?file=${base64Link}`;

            // 2. Create the HTML
            const embedHtml = `<!-- Mobile Friendly Link -->
<div style="text-align: right; margin-bottom: 8px;">
    <a href="${finalUrl}" target="_blank" referrerpolicy="origin" style="text-decoration: none; color: #333; font-family: sans-serif; font-size: 0.9em; border: 1px solid #ccc; padding: 5px 10px; border-radius: 4px; background-color: #f9f9f9;">
        <span style="font-size: 1.1em; margin-right: 4px;">&#x2197;</span> Open Full Screen
    </a>
</div>
<!-- The PDF Reader -->
<iframe src="${finalUrl}" width="100%" height="900" style="border: 1px solid #ccc; border-radius: 4px;" referrerpolicy="origin" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe>`;

            // 3. Show Results
            document.getElementById('finalLink').textContent = finalUrl;
            document.getElementById('embedCode').textContent = embedHtml;
            document.getElementById('results').style.display = 'block';
        }
    </script>

</body>
</html>
